/*
  These C codes generated by Cpi version 1.0
  Copyright (C) 2019 Alireza Rashti.
*/


#include "bbn_headers.h"

static void build_metric_and_metric_inverse(Patch_T *const patch);
static void build_metric_derivatives(Patch_T *const patch);
static void build_Gamma_derivatives(Patch_T *const patch);

#define add_field_and_get_field(name) ADD_FIELD(name) PREP_FIELD(name)

void bbn_make_metric_and_Gamma_and_derivatives(Grid_T *const grid)
{
  const unsigned np = grid->np;
  unsigned p;

  OpenMP_1d_Pragma(omp parallel for)
  for(p = 0; p < np; ++p)
  {
    Patch_T *patch = grid->patch[p];
    build_metric_and_metric_inverse(patch);
    build_metric_derivatives(patch);

    /* declaring: */
    GET_FIELD(gammaI_U2U2)
    GET_FIELD(gammaI_U0U0)
    GET_FIELD(gammaI_U0U1)
    GET_FIELD(gammaI_U0U2)
    GET_FIELD(gammaI_U1U1)
    GET_FIELD(gammaI_U1U2)
    GET_FIELD(dgamma_D2D2D2)
    GET_FIELD(dgamma_D2D2D1)
    GET_FIELD(dgamma_D0D1D1)
    GET_FIELD(dgamma_D1D2D2)
    GET_FIELD(dgamma_D1D2D0)
    GET_FIELD(dgamma_D1D1D2)
    GET_FIELD(dgamma_D1D1D1)
    GET_FIELD(dgamma_D1D1D0)
    GET_FIELD(dgamma_D2D2D0)
    GET_FIELD(dgamma_D0D2D1)
    GET_FIELD(dgamma_D0D2D0)
    GET_FIELD(dgamma_D0D2D2)
    GET_FIELD(dgamma_D1D2D1)
    GET_FIELD(dgamma_D0D1D2)
    GET_FIELD(dgamma_D0D0D2)
    GET_FIELD(dgamma_D0D0D1)
    GET_FIELD(dgamma_D0D0D0)
    GET_FIELD(dgamma_D0D1D0)
    add_field_and_get_field(Gamma_U1D0D0)
    add_field_and_get_field(Gamma_U0D2D2)
    add_field_and_get_field(Gamma_U1D0D2)
    add_field_and_get_field(Gamma_U2D1D2)
    add_field_and_get_field(Gamma_U1D0D1)
    add_field_and_get_field(Gamma_U1D2D2)
    add_field_and_get_field(Gamma_U2D0D2)
    add_field_and_get_field(Gamma_U2D0D0)
    add_field_and_get_field(Gamma_U0D0D1)
    add_field_and_get_field(Gamma_U0D0D0)
    add_field_and_get_field(Gamma_U2D0D1)
    add_field_and_get_field(Gamma_U0D0D2)
    add_field_and_get_field(Gamma_U2D2D2)
    add_field_and_get_field(Gamma_U1D1D1)
    add_field_and_get_field(Gamma_U0D1D1)
    add_field_and_get_field(Gamma_U0D1D2)
    add_field_and_get_field(Gamma_U1D1D2)
    add_field_and_get_field(Gamma_U2D1D1)
    ADD_FIELD_NoMem(dGamma_U1D0D1D2)
    ADD_FIELD_NoMem(dGamma_U1D2D2D2)
    ADD_FIELD_NoMem(dGamma_U1D0D1D0)
    ADD_FIELD_NoMem(dGamma_U1D0D1D1)
    ADD_FIELD_NoMem(dGamma_U2D0D2D2)
    ADD_FIELD_NoMem(dGamma_U2D1D1D2)
    ADD_FIELD_NoMem(dGamma_U2D0D0D1)
    ADD_FIELD_NoMem(dGamma_U1D0D0D2)
    ADD_FIELD_NoMem(dGamma_U1D0D0D1)
    ADD_FIELD_NoMem(dGamma_U1D0D0D0)
    ADD_FIELD_NoMem(dGamma_U1D2D2D1)
    ADD_FIELD_NoMem(dGamma_U1D0D2D1)
    ADD_FIELD_NoMem(dGamma_U1D0D2D0)
    ADD_FIELD_NoMem(dGamma_U1D0D2D2)
    ADD_FIELD_NoMem(dGamma_U0D1D1D2)
    ADD_FIELD_NoMem(dGamma_U0D1D1D0)
    ADD_FIELD_NoMem(dGamma_U0D1D1D1)
    ADD_FIELD_NoMem(dGamma_U2D0D1D2)
    ADD_FIELD_NoMem(dGamma_U0D1D2D1)
    ADD_FIELD_NoMem(dGamma_U0D1D2D0)
    ADD_FIELD_NoMem(dGamma_U0D1D2D2)
    ADD_FIELD_NoMem(dGamma_U2D2D2D0)
    ADD_FIELD_NoMem(dGamma_U2D2D2D1)
    ADD_FIELD_NoMem(dGamma_U2D2D2D2)
    ADD_FIELD_NoMem(dGamma_U1D2D2D0)
    ADD_FIELD_NoMem(dGamma_U0D0D2D0)
    ADD_FIELD_NoMem(dGamma_U0D0D2D1)
    ADD_FIELD_NoMem(dGamma_U0D0D2D2)
    ADD_FIELD_NoMem(dGamma_U2D0D1D0)
    ADD_FIELD_NoMem(dGamma_U1D1D2D0)
    ADD_FIELD_NoMem(dGamma_U1D1D2D1)
    ADD_FIELD_NoMem(dGamma_U1D1D2D2)
    ADD_FIELD_NoMem(dGamma_U1D1D1D1)
    ADD_FIELD_NoMem(dGamma_U0D0D0D2)
    ADD_FIELD_NoMem(dGamma_U2D1D1D1)
    ADD_FIELD_NoMem(dGamma_U0D0D0D0)
    ADD_FIELD_NoMem(dGamma_U0D0D0D1)
    ADD_FIELD_NoMem(dGamma_U2D1D1D0)
    ADD_FIELD_NoMem(dGamma_U0D0D1D2)
    ADD_FIELD_NoMem(dGamma_U0D0D1D1)
    ADD_FIELD_NoMem(dGamma_U0D0D1D0)
    ADD_FIELD_NoMem(dGamma_U0D2D2D2)
    ADD_FIELD_NoMem(dGamma_U1D1D1D2)
    ADD_FIELD_NoMem(dGamma_U0D2D2D0)
    ADD_FIELD_NoMem(dGamma_U0D2D2D1)
    ADD_FIELD_NoMem(dGamma_U2D0D0D2)
    ADD_FIELD_NoMem(dGamma_U2D1D2D2)
    ADD_FIELD_NoMem(dGamma_U2D0D1D1)
    ADD_FIELD_NoMem(dGamma_U2D1D2D0)
    ADD_FIELD_NoMem(dGamma_U2D0D2D0)
    ADD_FIELD_NoMem(dGamma_U2D0D2D1)
    ADD_FIELD_NoMem(dGamma_U1D1D1D0)
    ADD_FIELD_NoMem(dGamma_U2D0D0D0)
    ADD_FIELD_NoMem(dGamma_U2D1D2D1)


    unsigned nn = patch->nn;
    unsigned ijk;
    for(ijk = 0; ijk < nn; ++ijk)
    {
    double GAMMA_U1D0D0 = 
0.5*dgamma_D0D0D0[ijk]*gammaI_U0U1[ijk] - 0.5*gammaI_U1U1[ijk]*
(dgamma_D0D0D1[ijk] - 2*dgamma_D0D1D0[ijk]) - 0.5*gammaI_U1U2[ijk]*
(dgamma_D0D0D2[ijk] - 2*dgamma_D0D2D0[ijk]);

    double GAMMA_U0D2D2 = 
0.5*dgamma_D2D2D2[ijk]*gammaI_U0U2[ijk] + 0.5*gammaI_U0U0[ijk]*(2*
dgamma_D0D2D2[ijk] - dgamma_D2D2D0[ijk]) + 0.5*gammaI_U0U1[ijk]*(2*
dgamma_D1D2D2[ijk] - dgamma_D2D2D1[ijk]);

    double GAMMA_U1D0D2 = 
0.5*dgamma_D0D0D2[ijk]*gammaI_U0U1[ijk] + 0.5*dgamma_D2D2D0[ijk]*
gammaI_U1U2[ijk] + 0.5*gammaI_U1U1[ijk]*(dgamma_D0D1D2[ijk] - 
dgamma_D0D2D1[ijk] + dgamma_D1D2D0[ijk]);

    double GAMMA_U2D2D2 = 
0.5*dgamma_D2D2D2[ijk]*gammaI_U2U2[ijk] + 0.5*gammaI_U0U2[ijk]*(2*
dgamma_D0D2D2[ijk] - dgamma_D2D2D0[ijk]) + 0.5*gammaI_U1U2[ijk]*(2*
dgamma_D1D2D2[ijk] - dgamma_D2D2D1[ijk]);

    double GAMMA_U2D1D1 = 
0.5*dgamma_D1D1D1[ijk]*gammaI_U1U2[ijk] + 0.5*gammaI_U0U2[ijk]*(2*
dgamma_D0D1D1[ijk] - dgamma_D1D1D0[ijk]) - 0.5*gammaI_U2U2[ijk]*
(dgamma_D1D1D2[ijk] - 2*dgamma_D1D2D1[ijk]);

    double GAMMA_U1D0D1 = 
0.5*dgamma_D0D0D1[ijk]*gammaI_U0U1[ijk] + 0.5*dgamma_D1D1D0[ijk]*
gammaI_U1U1[ijk] + 0.5*gammaI_U1U2[ijk]*(-dgamma_D0D1D2[ijk] + 
dgamma_D0D2D1[ijk] + dgamma_D1D2D0[ijk]);

    double GAMMA_U1D2D2 = 
0.5*dgamma_D2D2D2[ijk]*gammaI_U1U2[ijk] + 0.5*gammaI_U0U1[ijk]*(2*
dgamma_D0D2D2[ijk] - dgamma_D2D2D0[ijk]) + 0.5*gammaI_U1U1[ijk]*(2*
dgamma_D1D2D2[ijk] - dgamma_D2D2D1[ijk]);

    double GAMMA_U2D1D2 = 
0.5*dgamma_D1D1D2[ijk]*gammaI_U1U2[ijk] + 0.5*dgamma_D2D2D1[ijk]*
gammaI_U2U2[ijk] + 0.5*gammaI_U0U2[ijk]*(dgamma_D0D1D2[ijk] + 
dgamma_D0D2D1[ijk] - dgamma_D1D2D0[ijk]);

    double GAMMA_U2D0D2 = 
0.5*dgamma_D0D0D2[ijk]*gammaI_U0U2[ijk] + 0.5*dgamma_D2D2D0[ijk]*
gammaI_U2U2[ijk] + 0.5*gammaI_U1U2[ijk]*(dgamma_D0D1D2[ijk] - 
dgamma_D0D2D1[ijk] + dgamma_D1D2D0[ijk]);

    double GAMMA_U2D0D1 = 
0.5*dgamma_D0D0D1[ijk]*gammaI_U0U2[ijk] + 0.5*dgamma_D1D1D0[ijk]*
gammaI_U1U2[ijk] + 0.5*gammaI_U2U2[ijk]*(-dgamma_D0D1D2[ijk] + 
dgamma_D0D2D1[ijk] + dgamma_D1D2D0[ijk]);

    double GAMMA_U2D0D0 = 
0.5*dgamma_D0D0D0[ijk]*gammaI_U0U2[ijk] - 0.5*gammaI_U1U2[ijk]*
(dgamma_D0D0D1[ijk] - 2*dgamma_D0D1D0[ijk]) - 0.5*gammaI_U2U2[ijk]*
(dgamma_D0D0D2[ijk] - 2*dgamma_D0D2D0[ijk]);

    double GAMMA_U0D0D2 = 
0.5*dgamma_D0D0D2[ijk]*gammaI_U0U0[ijk] + 0.5*dgamma_D2D2D0[ijk]*
gammaI_U0U2[ijk] + 0.5*gammaI_U0U1[ijk]*(dgamma_D0D1D2[ijk] - 
dgamma_D0D2D1[ijk] + dgamma_D1D2D0[ijk]);

    double GAMMA_U1D1D1 = 
0.5*dgamma_D1D1D1[ijk]*gammaI_U1U1[ijk] + 0.5*gammaI_U0U1[ijk]*(2*
dgamma_D0D1D1[ijk] - dgamma_D1D1D0[ijk]) - 0.5*gammaI_U1U2[ijk]*
(dgamma_D1D1D2[ijk] - 2*dgamma_D1D2D1[ijk]);

    double GAMMA_U0D1D1 = 
0.5*dgamma_D1D1D1[ijk]*gammaI_U0U1[ijk] + 0.5*gammaI_U0U0[ijk]*(2*
dgamma_D0D1D1[ijk] - dgamma_D1D1D0[ijk]) - 0.5*gammaI_U0U2[ijk]*
(dgamma_D1D1D2[ijk] - 2*dgamma_D1D2D1[ijk]);

    double GAMMA_U0D0D0 = 
0.5*dgamma_D0D0D0[ijk]*gammaI_U0U0[ijk] - 0.5*gammaI_U0U1[ijk]*
(dgamma_D0D0D1[ijk] - 2*dgamma_D0D1D0[ijk]) - 0.5*gammaI_U0U2[ijk]*
(dgamma_D0D0D2[ijk] - 2*dgamma_D0D2D0[ijk]);

    double GAMMA_U1D1D2 = 
0.5*dgamma_D1D1D2[ijk]*gammaI_U1U1[ijk] + 0.5*dgamma_D2D2D1[ijk]*
gammaI_U1U2[ijk] + 0.5*gammaI_U0U1[ijk]*(dgamma_D0D1D2[ijk] + 
dgamma_D0D2D1[ijk] - dgamma_D1D2D0[ijk]);

    double GAMMA_U0D0D1 = 
0.5*dgamma_D0D0D1[ijk]*gammaI_U0U0[ijk] + 0.5*dgamma_D1D1D0[ijk]*
gammaI_U0U1[ijk] + 0.5*gammaI_U0U2[ijk]*(-dgamma_D0D1D2[ijk] + 
dgamma_D0D2D1[ijk] + dgamma_D1D2D0[ijk]);

    double GAMMA_U0D1D2 = 
0.5*dgamma_D1D1D2[ijk]*gammaI_U0U1[ijk] + 0.5*dgamma_D2D2D1[ijk]*
gammaI_U0U2[ijk] + 0.5*gammaI_U0U0[ijk]*(dgamma_D0D1D2[ijk] + 
dgamma_D0D2D1[ijk] - dgamma_D1D2D0[ijk]);


    /* populating: */
    Gamma_U1D0D0[ijk] = GAMMA_U1D0D0;
    Gamma_U0D2D2[ijk] = GAMMA_U0D2D2;
    Gamma_U1D0D2[ijk] = GAMMA_U1D0D2;
    Gamma_U2D1D2[ijk] = GAMMA_U2D1D2;
    Gamma_U1D0D1[ijk] = GAMMA_U1D0D1;
    Gamma_U1D2D2[ijk] = GAMMA_U1D2D2;
    Gamma_U2D0D2[ijk] = GAMMA_U2D0D2;
    Gamma_U2D0D0[ijk] = GAMMA_U2D0D0;
    Gamma_U0D0D1[ijk] = GAMMA_U0D0D1;
    Gamma_U0D0D0[ijk] = GAMMA_U0D0D0;
    Gamma_U2D0D1[ijk] = GAMMA_U2D0D1;
    Gamma_U0D0D2[ijk] = GAMMA_U0D0D2;
    Gamma_U2D2D2[ijk] = GAMMA_U2D2D2;
    Gamma_U1D1D1[ijk] = GAMMA_U1D1D1;
    Gamma_U0D1D1[ijk] = GAMMA_U0D1D1;
    Gamma_U0D1D2[ijk] = GAMMA_U0D1D2;
    Gamma_U1D1D2[ijk] = GAMMA_U1D1D2;
    Gamma_U2D1D1[ijk] = GAMMA_U2D1D1;
    }/*end of for(ijk = 0; ijk < nn; ++ijk)*/
    build_Gamma_derivatives(patch);
  }
}

/* partial derivtive of Gamma, used in covariant derivative and R */
static void build_Gamma_derivatives(Patch_T *const patch)
{

  /* partial derivative of _Gamma */
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D2D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D2D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D2D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D0D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D1D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D0D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D1D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D1D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D1D1D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D0D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D1D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D1D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D1D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D2D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D0D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D0D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D0D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D1D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D1D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D1D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D0D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D1D1D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D1D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D2D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D1D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D1D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D1D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D0D1D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D1D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D1D1D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D1D1D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D1D1D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D2D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D1D1D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D1D1D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U1D1D1D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D1D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D1D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D0D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D0D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D0D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U2D1D1D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D2D2D0)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D2D2D1)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D2D2D2)
  DECLARE_AND_EMPTY_FIELD(dGamma_U0D0D1D2)
  
  /* _Gamma */
  DECLARE_FIELD(Gamma_U2D1D1)
  DECLARE_FIELD(Gamma_U2D1D2)
  DECLARE_FIELD(Gamma_U0D1D1)
  DECLARE_FIELD(Gamma_U2D0D2)
  DECLARE_FIELD(Gamma_U2D2D2)
  DECLARE_FIELD(Gamma_U0D1D2)
  DECLARE_FIELD(Gamma_U0D0D2)
  DECLARE_FIELD(Gamma_U0D0D1)
  DECLARE_FIELD(Gamma_U0D0D0)
  DECLARE_FIELD(Gamma_U1D2D2)
  DECLARE_FIELD(Gamma_U2D0D1)
  DECLARE_FIELD(Gamma_U0D2D2)
  DECLARE_FIELD(Gamma_U2D0D0)
  DECLARE_FIELD(Gamma_U1D0D2)
  DECLARE_FIELD(Gamma_U1D1D2)
  DECLARE_FIELD(Gamma_U1D0D0)
  DECLARE_FIELD(Gamma_U1D0D1)
  DECLARE_FIELD(Gamma_U1D1D1)

  /* populating partial derivative of _Gamma */
  dGamma_U2D2D2D2->v = Partial_Derivative(Gamma_U2D2D2,"z");
  dGamma_U2D2D2D0->v = Partial_Derivative(Gamma_U2D2D2,"x");
  dGamma_U2D2D2D1->v = Partial_Derivative(Gamma_U2D2D2,"y");
  dGamma_U2D0D0D2->v = Partial_Derivative(Gamma_U2D0D0,"z");
  dGamma_U1D1D2D2->v = Partial_Derivative(Gamma_U1D1D2,"z");
  dGamma_U2D0D0D0->v = Partial_Derivative(Gamma_U2D0D0,"x");
  dGamma_U1D1D2D0->v = Partial_Derivative(Gamma_U1D1D2,"x");
  dGamma_U1D1D2D1->v = Partial_Derivative(Gamma_U1D1D2,"y");
  dGamma_U2D1D1D0->v = Partial_Derivative(Gamma_U2D1D1,"x");
  dGamma_U2D0D0D1->v = Partial_Derivative(Gamma_U2D0D0,"y");
  dGamma_U2D0D2D1->v = Partial_Derivative(Gamma_U2D0D2,"y");
  dGamma_U1D0D1D0->v = Partial_Derivative(Gamma_U1D0D1,"x");
  dGamma_U1D0D1D1->v = Partial_Derivative(Gamma_U1D0D1,"y");
  dGamma_U1D0D1D2->v = Partial_Derivative(Gamma_U1D0D1,"z");
  dGamma_U1D2D2D1->v = Partial_Derivative(Gamma_U1D2D2,"y");
  dGamma_U1D0D0D1->v = Partial_Derivative(Gamma_U1D0D0,"y");
  dGamma_U1D0D0D0->v = Partial_Derivative(Gamma_U1D0D0,"x");
  dGamma_U1D0D0D2->v = Partial_Derivative(Gamma_U1D0D0,"z");
  dGamma_U0D1D2D2->v = Partial_Derivative(Gamma_U0D1D2,"z");
  dGamma_U0D1D2D1->v = Partial_Derivative(Gamma_U0D1D2,"y");
  dGamma_U0D1D2D0->v = Partial_Derivative(Gamma_U0D1D2,"x");
  dGamma_U2D0D2D0->v = Partial_Derivative(Gamma_U2D0D2,"x");
  dGamma_U1D0D2D2->v = Partial_Derivative(Gamma_U1D0D2,"z");
  dGamma_U1D0D2D1->v = Partial_Derivative(Gamma_U1D0D2,"y");
  dGamma_U1D0D2D0->v = Partial_Derivative(Gamma_U1D0D2,"x");
  dGamma_U2D1D1D2->v = Partial_Derivative(Gamma_U2D1D1,"z");
  dGamma_U2D0D2D2->v = Partial_Derivative(Gamma_U2D0D2,"z");
  dGamma_U0D0D1D0->v = Partial_Derivative(Gamma_U0D0D1,"x");
  dGamma_U1D2D2D0->v = Partial_Derivative(Gamma_U1D2D2,"x");
  dGamma_U2D1D2D1->v = Partial_Derivative(Gamma_U2D1D2,"y");
  dGamma_U2D0D1D2->v = Partial_Derivative(Gamma_U2D0D1,"z");
  dGamma_U2D0D1D1->v = Partial_Derivative(Gamma_U2D0D1,"y");
  dGamma_U2D0D1D0->v = Partial_Derivative(Gamma_U2D0D1,"x");
  dGamma_U2D1D2D2->v = Partial_Derivative(Gamma_U2D1D2,"z");
  dGamma_U0D1D1D0->v = Partial_Derivative(Gamma_U0D1D1,"x");
  dGamma_U0D1D1D1->v = Partial_Derivative(Gamma_U0D1D1,"y");
  dGamma_U0D1D1D2->v = Partial_Derivative(Gamma_U0D1D1,"z");
  dGamma_U1D2D2D2->v = Partial_Derivative(Gamma_U1D2D2,"z");
  dGamma_U1D1D1D1->v = Partial_Derivative(Gamma_U1D1D1,"y");
  dGamma_U1D1D1D0->v = Partial_Derivative(Gamma_U1D1D1,"x");
  dGamma_U1D1D1D2->v = Partial_Derivative(Gamma_U1D1D1,"z");
  dGamma_U0D0D1D1->v = Partial_Derivative(Gamma_U0D0D1,"y");
  dGamma_U0D0D2D2->v = Partial_Derivative(Gamma_U0D0D2,"z");
  dGamma_U0D0D2D0->v = Partial_Derivative(Gamma_U0D0D2,"x");
  dGamma_U0D0D2D1->v = Partial_Derivative(Gamma_U0D0D2,"y");
  dGamma_U2D1D2D0->v = Partial_Derivative(Gamma_U2D1D2,"x");
  dGamma_U0D0D0D0->v = Partial_Derivative(Gamma_U0D0D0,"x");
  dGamma_U0D0D0D1->v = Partial_Derivative(Gamma_U0D0D0,"y");
  dGamma_U0D0D0D2->v = Partial_Derivative(Gamma_U0D0D0,"z");
  dGamma_U2D1D1D1->v = Partial_Derivative(Gamma_U2D1D1,"y");
  dGamma_U0D2D2D0->v = Partial_Derivative(Gamma_U0D2D2,"x");
  dGamma_U0D2D2D1->v = Partial_Derivative(Gamma_U0D2D2,"y");
  dGamma_U0D2D2D2->v = Partial_Derivative(Gamma_U0D2D2,"z");
  dGamma_U0D0D1D2->v = Partial_Derivative(Gamma_U0D0D1,"z");
}

/* to make christoffer symbol we need derivative of the metric, 
// this function does that. */
static void build_metric_and_metric_inverse(Patch_T *const patch)
{
  const unsigned nn = patch->nn;
  unsigned ijk;

  GET_FIELD(_gamma_D2D2)
  GET_FIELD(_gamma_D0D2)
  GET_FIELD(_gamma_D0D0)
  GET_FIELD(_gamma_D0D1)
  GET_FIELD(_gamma_D1D2)
  GET_FIELD(_gamma_D1D1)
  GET_FIELD(_gammaI_U0U2)
  GET_FIELD(_gammaI_U0U0)
  GET_FIELD(_gammaI_U0U1)
  GET_FIELD(_gammaI_U1U2)
  GET_FIELD(_gammaI_U1U1)
  GET_FIELD(_gammaI_U2U2)

  ADD_FIELD(gamma_D2D2)
  ADD_FIELD(gamma_D0D2)
  ADD_FIELD(gamma_D0D0)
  ADD_FIELD(gamma_D0D1)
  ADD_FIELD(gamma_D1D2)
  ADD_FIELD(gamma_D1D1)
  ADD_FIELD(gammaI_U0U2)
  ADD_FIELD(gammaI_U0U0)
  ADD_FIELD(gammaI_U0U1)
  ADD_FIELD(gammaI_U1U2)
  ADD_FIELD(gammaI_U1U1)
  ADD_FIELD(gammaI_U2U2)

  PREP_FIELD(gamma_D2D2)
  PREP_FIELD(gamma_D0D2)
  PREP_FIELD(gamma_D0D0)
  PREP_FIELD(gamma_D0D1)
  PREP_FIELD(gamma_D1D2)
  PREP_FIELD(gamma_D1D1)

  PREP_FIELD(gammaI_U0U2)
  PREP_FIELD(gammaI_U0U0)
  PREP_FIELD(gammaI_U0U1)
  PREP_FIELD(gammaI_U1U2)
  PREP_FIELD(gammaI_U1U1)
  PREP_FIELD(gammaI_U2U2)
  
  GET_FIELD(psi)
  for (ijk = 0; ijk < nn; ++ijk)
  {
    double psi4  = pow(psi[ijk],4);
    double psim4 = pow(psi[ijk],-4);

    gamma_D0D0[ijk] = psi4*_gamma_D0D0[ijk];
    gamma_D0D1[ijk] = psi4*_gamma_D0D1[ijk];
    gamma_D0D2[ijk] = psi4*_gamma_D0D2[ijk];
    gamma_D1D1[ijk] = psi4*_gamma_D1D1[ijk];
    gamma_D1D2[ijk] = psi4*_gamma_D1D2[ijk];
    gamma_D2D2[ijk] = psi4*_gamma_D2D2[ijk];
    
    gammaI_U0U0[ijk] = psim4*_gammaI_U0U0[ijk];
    gammaI_U0U1[ijk] = psim4*_gammaI_U0U1[ijk];
    gammaI_U0U2[ijk] = psim4*_gammaI_U0U2[ijk];
    gammaI_U1U1[ijk] = psim4*_gammaI_U1U1[ijk];
    gammaI_U1U2[ijk] = psim4*_gammaI_U1U2[ijk];
    gammaI_U2U2[ijk] = psim4*_gammaI_U2U2[ijk];

  }
  
}

/* to make christoffer symbol we need derivative of the metric, 
// this function does that. */
static void build_metric_derivatives(Patch_T *const patch)
{
  /* declaring metric */
  DECLARE_FIELD(gamma_D2D2)
  DECLARE_FIELD(gamma_D0D2)
  DECLARE_FIELD(gamma_D0D0)
  DECLARE_FIELD(gamma_D0D1)
  DECLARE_FIELD(gamma_D1D2)
  DECLARE_FIELD(gamma_D1D1)

  /* add fields for derivative of the metric */
  ADD_FIELD_NoMem(dgamma_D0D0D1)
  ADD_FIELD_NoMem(dgamma_D0D0D0)
  ADD_FIELD_NoMem(dgamma_D2D2D2)
  ADD_FIELD_NoMem(dgamma_D0D0D2)
  ADD_FIELD_NoMem(dgamma_D0D2D1)
  ADD_FIELD_NoMem(dgamma_D1D1D0)
  ADD_FIELD_NoMem(dgamma_D1D1D2)
  ADD_FIELD_NoMem(dgamma_D2D2D0)
  ADD_FIELD_NoMem(dgamma_D2D2D1)
  ADD_FIELD_NoMem(dgamma_D0D1D0)
  ADD_FIELD_NoMem(dgamma_D0D1D1)
  ADD_FIELD_NoMem(dgamma_D0D1D2)
  ADD_FIELD_NoMem(dgamma_D0D2D0)
  ADD_FIELD_NoMem(dgamma_D1D1D1)
  ADD_FIELD_NoMem(dgamma_D1D2D1)
  ADD_FIELD_NoMem(dgamma_D1D2D2)
  ADD_FIELD_NoMem(dgamma_D1D2D0)
  ADD_FIELD_NoMem(dgamma_D0D2D2)

  DECLARE_FIELD(dgamma_D0D0D1)
  DECLARE_FIELD(dgamma_D0D0D0)
  DECLARE_FIELD(dgamma_D2D2D2)
  DECLARE_FIELD(dgamma_D0D0D2)
  DECLARE_FIELD(dgamma_D0D2D1)
  DECLARE_FIELD(dgamma_D1D1D0)
  DECLARE_FIELD(dgamma_D1D1D2)
  DECLARE_FIELD(dgamma_D2D2D0)
  DECLARE_FIELD(dgamma_D2D2D1)
  DECLARE_FIELD(dgamma_D0D1D0)
  DECLARE_FIELD(dgamma_D0D1D1)
  DECLARE_FIELD(dgamma_D0D1D2)
  DECLARE_FIELD(dgamma_D0D2D0)
  DECLARE_FIELD(dgamma_D1D1D1)
  DECLARE_FIELD(dgamma_D1D2D1)
  DECLARE_FIELD(dgamma_D1D2D2)
  DECLARE_FIELD(dgamma_D1D2D0)
  DECLARE_FIELD(dgamma_D0D2D2)

  /* filling the values */
  dgamma_D0D0D0->v = Partial_Derivative(gamma_D0D0,"x");
  dgamma_D0D0D1->v = Partial_Derivative(gamma_D0D0,"y");
  dgamma_D0D0D2->v = Partial_Derivative(gamma_D0D0,"z");
  dgamma_D1D2D2->v = Partial_Derivative(gamma_D1D2,"z");
  dgamma_D1D1D0->v = Partial_Derivative(gamma_D1D1,"x");
  dgamma_D0D1D1->v = Partial_Derivative(gamma_D0D1,"y");
  dgamma_D0D1D0->v = Partial_Derivative(gamma_D0D1,"x");
  dgamma_D1D1D2->v = Partial_Derivative(gamma_D1D1,"z");
  dgamma_D0D1D2->v = Partial_Derivative(gamma_D0D1,"z");
  dgamma_D0D2D2->v = Partial_Derivative(gamma_D0D2,"z");
  dgamma_D1D2D1->v = Partial_Derivative(gamma_D1D2,"y");
  dgamma_D0D2D0->v = Partial_Derivative(gamma_D0D2,"x");
  dgamma_D0D2D1->v = Partial_Derivative(gamma_D0D2,"y");
  dgamma_D2D2D2->v = Partial_Derivative(gamma_D2D2,"z");
  dgamma_D2D2D0->v = Partial_Derivative(gamma_D2D2,"x");
  dgamma_D1D2D0->v = Partial_Derivative(gamma_D1D2,"x");
  dgamma_D1D1D1->v = Partial_Derivative(gamma_D1D1,"y");
  dgamma_D2D2D1->v = Partial_Derivative(gamma_D2D2,"y");

}

/* freeing metric derivatives */
void bbn_free_metric_and_Gamma_and_derivatives(Grid_T *const grid)
{
  const unsigned np = grid->np;
  unsigned p;

  OpenMP_1d_Pragma(omp parallel for)
  for(p = 0; p < np; ++p)
  {
  Patch_T *patch = grid->patch[p];
  /* declare */
  DECLARE_FIELD(gamma_D2D2)
  DECLARE_FIELD(gamma_D0D2)
  DECLARE_FIELD(gamma_D0D0)
  DECLARE_FIELD(gamma_D0D1)
  DECLARE_FIELD(gamma_D1D2)
  DECLARE_FIELD(gamma_D1D1)

  DECLARE_FIELD(gammaI_U0U2)
  DECLARE_FIELD(gammaI_U0U0)
  DECLARE_FIELD(gammaI_U0U1)
  DECLARE_FIELD(gammaI_U1U2)
  DECLARE_FIELD(gammaI_U1U1)
  DECLARE_FIELD(gammaI_U2U2)

  REMOVE_FIELD(gamma_D2D2)
  REMOVE_FIELD(gamma_D0D2)
  REMOVE_FIELD(gamma_D0D0)
  REMOVE_FIELD(gamma_D0D1)
  REMOVE_FIELD(gamma_D1D2)
  REMOVE_FIELD(gamma_D1D1)

  REMOVE_FIELD(gammaI_U0U2)
  REMOVE_FIELD(gammaI_U0U0)
  REMOVE_FIELD(gammaI_U0U1)
  REMOVE_FIELD(gammaI_U1U2)
  REMOVE_FIELD(gammaI_U1U1)
  REMOVE_FIELD(gammaI_U2U2)

  /* declare _dgamma */
  DECLARE_FIELD(dgamma_D0D0D1)
  DECLARE_FIELD(dgamma_D0D0D0)
  DECLARE_FIELD(dgamma_D2D2D2)
  DECLARE_FIELD(dgamma_D0D0D2)
  DECLARE_FIELD(dgamma_D0D2D1)
  DECLARE_FIELD(dgamma_D1D1D0)
  DECLARE_FIELD(dgamma_D1D1D2)
  DECLARE_FIELD(dgamma_D2D2D0)
  DECLARE_FIELD(dgamma_D2D2D1)
  DECLARE_FIELD(dgamma_D0D1D0)
  DECLARE_FIELD(dgamma_D0D1D1)
  DECLARE_FIELD(dgamma_D0D1D2)
  DECLARE_FIELD(dgamma_D0D2D0)
  DECLARE_FIELD(dgamma_D1D1D1)
  DECLARE_FIELD(dgamma_D1D2D1)
  DECLARE_FIELD(dgamma_D1D2D2)
  DECLARE_FIELD(dgamma_D1D2D0)
  DECLARE_FIELD(dgamma_D0D2D2)

  /* removing fields */
  REMOVE_FIELD(dgamma_D0D0D1)
  REMOVE_FIELD(dgamma_D0D0D0)
  REMOVE_FIELD(dgamma_D2D2D2)
  REMOVE_FIELD(dgamma_D0D0D2)
  REMOVE_FIELD(dgamma_D0D2D1)
  REMOVE_FIELD(dgamma_D1D1D0)
  REMOVE_FIELD(dgamma_D1D1D2)
  REMOVE_FIELD(dgamma_D2D2D0)
  REMOVE_FIELD(dgamma_D2D2D1)
  REMOVE_FIELD(dgamma_D0D1D0)
  REMOVE_FIELD(dgamma_D0D1D1)
  REMOVE_FIELD(dgamma_D0D1D2)
  REMOVE_FIELD(dgamma_D0D2D0)
  REMOVE_FIELD(dgamma_D1D1D1)
  REMOVE_FIELD(dgamma_D1D2D1)
  REMOVE_FIELD(dgamma_D1D2D2)
  REMOVE_FIELD(dgamma_D1D2D0)
  REMOVE_FIELD(dgamma_D0D2D2)

  DECLARE_FIELD(Gamma_U1D0D0)
  DECLARE_FIELD(Gamma_U0D2D2)
  DECLARE_FIELD(Gamma_U1D0D2)
  DECLARE_FIELD(Gamma_U2D1D2)
  DECLARE_FIELD(Gamma_U1D0D1)
  DECLARE_FIELD(Gamma_U1D2D2)
  DECLARE_FIELD(Gamma_U2D0D2)
  DECLARE_FIELD(Gamma_U2D0D0)
  DECLARE_FIELD(Gamma_U0D0D1)
  DECLARE_FIELD(Gamma_U0D0D0)
  DECLARE_FIELD(Gamma_U2D0D1)
  DECLARE_FIELD(Gamma_U0D0D2)
  DECLARE_FIELD(Gamma_U2D2D2)
  DECLARE_FIELD(Gamma_U1D1D1)
  DECLARE_FIELD(Gamma_U0D1D1)
  DECLARE_FIELD(Gamma_U0D1D2)
  DECLARE_FIELD(Gamma_U1D1D2)
  DECLARE_FIELD(Gamma_U2D1D1)

  REMOVE_FIELD(Gamma_U1D0D0)
  REMOVE_FIELD(Gamma_U0D2D2)
  REMOVE_FIELD(Gamma_U1D0D2)
  REMOVE_FIELD(Gamma_U2D1D2)
  REMOVE_FIELD(Gamma_U1D0D1)
  REMOVE_FIELD(Gamma_U1D2D2)
  REMOVE_FIELD(Gamma_U2D0D2)
  REMOVE_FIELD(Gamma_U2D0D0)
  REMOVE_FIELD(Gamma_U0D0D1)
  REMOVE_FIELD(Gamma_U0D0D0)
  REMOVE_FIELD(Gamma_U2D0D1)
  REMOVE_FIELD(Gamma_U0D0D2)
  REMOVE_FIELD(Gamma_U2D2D2)
  REMOVE_FIELD(Gamma_U1D1D1)
  REMOVE_FIELD(Gamma_U0D1D1)
  REMOVE_FIELD(Gamma_U0D1D2)
  REMOVE_FIELD(Gamma_U1D1D2)
  REMOVE_FIELD(Gamma_U2D1D1)

  DECLARE_FIELD(dGamma_U2D2D2D2)
  DECLARE_FIELD(dGamma_U2D2D2D0)
  DECLARE_FIELD(dGamma_U2D2D2D1)
  DECLARE_FIELD(dGamma_U2D0D0D2)
  DECLARE_FIELD(dGamma_U1D1D2D2)
  DECLARE_FIELD(dGamma_U2D0D0D0)
  DECLARE_FIELD(dGamma_U1D1D2D0)
  DECLARE_FIELD(dGamma_U1D1D2D1)
  DECLARE_FIELD(dGamma_U2D1D1D0)
  DECLARE_FIELD(dGamma_U2D0D0D1)
  DECLARE_FIELD(dGamma_U2D0D2D1)
  DECLARE_FIELD(dGamma_U1D0D1D0)
  DECLARE_FIELD(dGamma_U1D0D1D1)
  DECLARE_FIELD(dGamma_U1D0D1D2)
  DECLARE_FIELD(dGamma_U1D2D2D1)
  DECLARE_FIELD(dGamma_U1D0D0D1)
  DECLARE_FIELD(dGamma_U1D0D0D0)
  DECLARE_FIELD(dGamma_U1D0D0D2)
  DECLARE_FIELD(dGamma_U0D1D2D2)
  DECLARE_FIELD(dGamma_U0D1D2D1)
  DECLARE_FIELD(dGamma_U0D1D2D0)
  DECLARE_FIELD(dGamma_U2D0D2D0)
  DECLARE_FIELD(dGamma_U1D0D2D2)
  DECLARE_FIELD(dGamma_U1D0D2D1)
  DECLARE_FIELD(dGamma_U1D0D2D0)
  DECLARE_FIELD(dGamma_U2D1D1D2)
  DECLARE_FIELD(dGamma_U2D0D2D2)
  DECLARE_FIELD(dGamma_U0D0D1D0)
  DECLARE_FIELD(dGamma_U1D2D2D0)
  DECLARE_FIELD(dGamma_U2D1D2D1)
  DECLARE_FIELD(dGamma_U2D0D1D2)
  DECLARE_FIELD(dGamma_U2D0D1D1)
  DECLARE_FIELD(dGamma_U2D0D1D0)
  DECLARE_FIELD(dGamma_U2D1D2D2)
  DECLARE_FIELD(dGamma_U0D1D1D0)
  DECLARE_FIELD(dGamma_U0D1D1D1)
  DECLARE_FIELD(dGamma_U0D1D1D2)
  DECLARE_FIELD(dGamma_U1D2D2D2)
  DECLARE_FIELD(dGamma_U1D1D1D1)
  DECLARE_FIELD(dGamma_U1D1D1D0)
  DECLARE_FIELD(dGamma_U1D1D1D2)
  DECLARE_FIELD(dGamma_U0D0D1D1)
  DECLARE_FIELD(dGamma_U0D0D2D2)
  DECLARE_FIELD(dGamma_U0D0D2D0)
  DECLARE_FIELD(dGamma_U0D0D2D1)
  DECLARE_FIELD(dGamma_U2D1D2D0)
  DECLARE_FIELD(dGamma_U0D0D0D0)
  DECLARE_FIELD(dGamma_U0D0D0D1)
  DECLARE_FIELD(dGamma_U0D0D0D2)
  DECLARE_FIELD(dGamma_U2D1D1D1)
  DECLARE_FIELD(dGamma_U0D2D2D0)
  DECLARE_FIELD(dGamma_U0D2D2D1)
  DECLARE_FIELD(dGamma_U0D2D2D2)
  DECLARE_FIELD(dGamma_U0D0D1D2)
  REMOVE_FIELD(dGamma_U2D2D2D2)
  REMOVE_FIELD(dGamma_U2D2D2D0)
  REMOVE_FIELD(dGamma_U2D2D2D1)
  REMOVE_FIELD(dGamma_U2D0D0D2)
  REMOVE_FIELD(dGamma_U1D1D2D2)
  REMOVE_FIELD(dGamma_U2D0D0D0)
  REMOVE_FIELD(dGamma_U1D1D2D0)
  REMOVE_FIELD(dGamma_U1D1D2D1)
  REMOVE_FIELD(dGamma_U2D1D1D0)
  REMOVE_FIELD(dGamma_U2D0D0D1)
  REMOVE_FIELD(dGamma_U2D0D2D1)
  REMOVE_FIELD(dGamma_U1D0D1D0)
  REMOVE_FIELD(dGamma_U1D0D1D1)
  REMOVE_FIELD(dGamma_U1D0D1D2)
  REMOVE_FIELD(dGamma_U1D2D2D1)
  REMOVE_FIELD(dGamma_U1D0D0D1)
  REMOVE_FIELD(dGamma_U1D0D0D0)
  REMOVE_FIELD(dGamma_U1D0D0D2)
  REMOVE_FIELD(dGamma_U0D1D2D2)
  REMOVE_FIELD(dGamma_U0D1D2D1)
  REMOVE_FIELD(dGamma_U0D1D2D0)
  REMOVE_FIELD(dGamma_U2D0D2D0)
  REMOVE_FIELD(dGamma_U1D0D2D2)
  REMOVE_FIELD(dGamma_U1D0D2D1)
  REMOVE_FIELD(dGamma_U1D0D2D0)
  REMOVE_FIELD(dGamma_U2D1D1D2)
  REMOVE_FIELD(dGamma_U2D0D2D2)
  REMOVE_FIELD(dGamma_U0D0D1D0)
  REMOVE_FIELD(dGamma_U1D2D2D0)
  REMOVE_FIELD(dGamma_U2D1D2D1)
  REMOVE_FIELD(dGamma_U2D0D1D2)
  REMOVE_FIELD(dGamma_U2D0D1D1)
  REMOVE_FIELD(dGamma_U2D0D1D0)
  REMOVE_FIELD(dGamma_U2D1D2D2)
  REMOVE_FIELD(dGamma_U0D1D1D0)
  REMOVE_FIELD(dGamma_U0D1D1D1)
  REMOVE_FIELD(dGamma_U0D1D1D2)
  REMOVE_FIELD(dGamma_U1D2D2D2)
  REMOVE_FIELD(dGamma_U1D1D1D1)
  REMOVE_FIELD(dGamma_U1D1D1D0)
  REMOVE_FIELD(dGamma_U1D1D1D2)
  REMOVE_FIELD(dGamma_U0D0D1D1)
  REMOVE_FIELD(dGamma_U0D0D2D2)
  REMOVE_FIELD(dGamma_U0D0D2D0)
  REMOVE_FIELD(dGamma_U0D0D2D1)
  REMOVE_FIELD(dGamma_U2D1D2D0)
  REMOVE_FIELD(dGamma_U0D0D0D0)
  REMOVE_FIELD(dGamma_U0D0D0D1)
  REMOVE_FIELD(dGamma_U0D0D0D2)
  REMOVE_FIELD(dGamma_U2D1D1D1)
  REMOVE_FIELD(dGamma_U0D2D2D0)
  REMOVE_FIELD(dGamma_U0D2D2D1)
  REMOVE_FIELD(dGamma_U0D2D2D2)
  REMOVE_FIELD(dGamma_U0D0D1D2)
  }
}
