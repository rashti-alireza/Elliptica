/*
  These C codes generated by Cpi version 2.0
  Copyright (C) 2019-2020 Alireza Rashti.
*/


#include "bbn_headers.h"
#include "maths_linear_algebra_lib.h"

#define add_field_and_prep_field(name) \
 if (_Ind(#name) < 0) {ADD_FIELD(name)} REALLOC_v_WRITE_v(name)
void bbn_bam_adm_to_bssn(Patch_T *const patch);
void bbn_bam_adm_to_bssn(Patch_T *const patch)
{

  /* declaring: */
  READ_v(bam_adm_g_D0D0)
  READ_v(bam_adm_g_D0D1)
  READ_v(bam_adm_g_D0D2)
  READ_v(bam_adm_g_D2D2)
  READ_v(bam_adm_g_D1D1)
  READ_v(bam_adm_g_D1D2)
  READ_v(bam_adm_K_D1D1)
  READ_v(bam_adm_K_D2D2)
  READ_v(bam_adm_K_D0D0)
  READ_v(bam_adm_K_D0D1)
  READ_v(bam_adm_K_D0D2)
  READ_v(bam_adm_K_D1D2)
  add_field_and_prep_field(bam_bssn_g_D2D2)
  add_field_and_prep_field(bam_bssn_g_D1D1)
  add_field_and_prep_field(bam_bssn_g_D1D2)
  add_field_and_prep_field(bam_bssn_g_D0D1)
  add_field_and_prep_field(bam_bssn_g_D0D0)
  add_field_and_prep_field(bam_bssn_g_D0D2)
  add_field_and_prep_field(bam_bssn_gI_U2U2)
  add_field_and_prep_field(bam_bssn_gI_U0U2)
  add_field_and_prep_field(bam_bssn_gI_U0U1)
  add_field_and_prep_field(bam_bssn_gI_U0U0)
  add_field_and_prep_field(bam_bssn_gI_U1U2)
  add_field_and_prep_field(bam_bssn_gI_U1U1)
  add_field_and_prep_field(bam_bssn_A_D1D2)
  add_field_and_prep_field(bam_bssn_A_D1D1)
  add_field_and_prep_field(bam_bssn_A_D0D2)
  add_field_and_prep_field(bam_bssn_A_D0D1)
  add_field_and_prep_field(bam_bssn_A_D0D0)
  add_field_and_prep_field(bam_bssn_A_D2D2)
  add_field_and_prep_field(bam_bssn_psi)
  add_field_and_prep_field(bam_bssn_chi)
  add_field_and_prep_field(bam_bssn_K)


 unsigned nn = patch->nn;
 unsigned ijk;
 for(ijk = 0; ijk < nn; ++ijk)
 {
 double detgb;
 Determinant_Matrix_3x3_Symmetric_Field(bam_adm_g,D,ijk,detgb);

  double psi12 = 
detgb;

  double psi = 
pow(psi12, 0.083333333333333329);

  double psim4 = 
pow(psi12, -0.33333333333333331);

  double bssn_g_D0D0 = 
bam_adm_g_D0D0[ijk]*psim4;

  double bssn_g_D0D1 = 
bam_adm_g_D0D1[ijk]*psim4;

  double bssn_g_D0D2 = 
bam_adm_g_D0D2[ijk]*psim4;

  double bssn_g_D2D2 = 
bam_adm_g_D2D2[ijk]*psim4;

  double bssn_g_D1D1 = 
bam_adm_g_D1D1[ijk]*psim4;

  double bssn_g_D1D2 = 
bam_adm_g_D1D2[ijk]*psim4;

  double Kt_U2U2 = 
bam_adm_K_D2D2[ijk]*psim4;

  double Kt_U1U2 = 
bam_adm_K_D1D2[ijk]*psim4;

  double Kt_U1U1 = 
bam_adm_K_D1D1[ijk]*psim4;

  double Kt_U0U2 = 
bam_adm_K_D0D2[ijk]*psim4;

  double Kt_U0U1 = 
bam_adm_K_D0D1[ijk]*psim4;

  double Kt_U0U0 = 
bam_adm_K_D0D0[ijk]*psim4;

  double bssn_gI_U0U0 = 
1.0;

  double bssn_gI_U0U1 = 
0;

  double bssn_gI_U0U2 = 
0;

  double bssn_gI_U1U1 = 
1.0;

  double bssn_gI_U1U2 = 
0;

  double bssn_gI_U2U2 = 
1.0;

 Matrix_Inverse_3x3_Symmetric_Var(bssn_g,D,bssn_gI,U);
 double K = 
Kt_U0U0*bam_bssn_gI_U0U0[ijk] + 2.0*Kt_U0U1*bam_bssn_gI_U0U1[ijk] +
2.0*Kt_U0U2*bam_bssn_gI_U0U2[ijk] + Kt_U1U1*bam_bssn_gI_U1U1[ijk] +
2.0*Kt_U1U2*bam_bssn_gI_U1U2[ijk] + Kt_U2U2*bam_bssn_gI_U2U2[ijk];

 double A_D1D2 = 
-1.0/3.0*K*bam_adm_g_D1D2[ijk] + bam_adm_K_D1D2[ijk];

 double A_D1D1 = 
-1.0/3.0*K*bam_adm_g_D1D1[ijk] + bam_adm_K_D1D1[ijk];

 double A_D2D2 = 
-1.0/3.0*K*bam_adm_g_D2D2[ijk] + bam_adm_K_D2D2[ijk];

 double A_D0D2 = 
-1.0/3.0*K*bam_adm_g_D0D2[ijk] + bam_adm_K_D0D2[ijk];

 double A_D0D0 = 
-1.0/3.0*K*bam_adm_g_D0D0[ijk] + bam_adm_K_D0D0[ijk];

 double A_D0D1 = 
-1.0/3.0*K*bam_adm_g_D0D1[ijk] + bam_adm_K_D0D1[ijk];

 double bssn_A_D0D2 = 
A_D0D2*psim4;

 double bssn_A_D0D0 = 
A_D0D0*psim4;

 double bssn_A_D0D1 = 
A_D0D1*psim4;

 double bssn_A_D1D2 = 
A_D1D2*psim4;

 double bssn_A_D1D1 = 
A_D1D1*psim4;

 double bssn_A_D2D2 = 
A_D2D2*psim4;


 /* populating: */
 bam_bssn_A_D1D2[ijk] = bssn_A_D1D2;
 bam_bssn_A_D1D1[ijk] = bssn_A_D1D1;
 bam_bssn_A_D0D2[ijk] = bssn_A_D0D2;
 bam_bssn_A_D0D1[ijk] = bssn_A_D0D1;
 bam_bssn_A_D0D0[ijk] = bssn_A_D0D0;
 bam_bssn_A_D2D2[ijk] = bssn_A_D2D2;

 /* populating: */
 bam_bssn_g_D2D2[ijk] = bssn_g_D2D2;
 bam_bssn_g_D1D1[ijk] = bssn_g_D1D1;
 bam_bssn_g_D1D2[ijk] = bssn_g_D1D2;
 bam_bssn_g_D0D1[ijk] = bssn_g_D0D1;
 bam_bssn_g_D0D0[ijk] = bssn_g_D0D0;
 bam_bssn_g_D0D2[ijk] = bssn_g_D0D2;

 /* populating: */
 bam_bssn_gI_U2U2[ijk] = bssn_gI_U2U2;
 bam_bssn_gI_U0U2[ijk] = bssn_gI_U0U2;
 bam_bssn_gI_U0U1[ijk] = bssn_gI_U0U1;
 bam_bssn_gI_U0U0[ijk] = bssn_gI_U0U0;
 bam_bssn_gI_U1U2[ijk] = bssn_gI_U1U2;
 bam_bssn_gI_U1U1[ijk] = bssn_gI_U1U1;
 bam_bssn_chi[ijk] = psim4;
 bam_bssn_psi[ijk] = psi;
 bam_bssn_K[ijk]   = K;
 }
}
