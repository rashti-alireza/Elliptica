/*
  These C codes generated by Cpi version 2.0
  Copyright (C) 2019-2020 Alireza Rashti.
*/


#include "bbn_headers.h"


double bbn_BH_ADM_mass(Observable_T *const obs);
double bbn_BH_ADM_mass(Observable_T *const obs)
{
  double adm_mass = 0;
  struct items_S **adm = obs->items;
  const unsigned N = obs->Nitems;
  unsigned p;

  for(p = 0; p < N; ++p)
  {
  Patch_T *patch = adm[p]->patch;
  bbn_1st_derivatives_conformal_metric(patch);


  /* declaring: */
  READ_v_UNUSED(psi)
  READ_v_UNUSED(dpsi_D2)
  READ_v_UNUSED(dpsi_D0)
  READ_v_UNUSED(dpsi_D1)
  READ_v_UNUSED(_dgamma_D1D1D2)
  READ_v_UNUSED(_dgamma_D0D2D0)
  READ_v_UNUSED(_dgamma_D1D1D1)
  READ_v_UNUSED(_dgamma_D1D2D2)
  READ_v_UNUSED(_dgamma_D1D2D1)
  READ_v_UNUSED(_dgamma_D2D2D1)
  READ_v_UNUSED(_dgamma_D0D1D1)
  READ_v_UNUSED(_dgamma_D0D0D2)
  READ_v_UNUSED(_dgamma_D0D1D2)
  READ_v_UNUSED(_dgamma_D0D2D1)
  READ_v_UNUSED(_dgamma_D2D2D2)
  READ_v_UNUSED(_dgamma_D2D2D0)
  READ_v_UNUSED(_dgamma_D0D0D0)
  READ_v_UNUSED(_dgamma_D0D0D1)
  READ_v_UNUSED(_dgamma_D0D1D0)
  READ_v_UNUSED(_dgamma_D1D1D0)
  READ_v_UNUSED(_dgamma_D0D2D2)
  READ_v_UNUSED(_dgamma_D1D2D0)
  READ_v_UNUSED(_gammaI_U1U1)
  READ_v_UNUSED(_gammaI_U0U2)
  READ_v_UNUSED(_gammaI_U0U1)
  READ_v_UNUSED(_gammaI_U1U2)
  READ_v_UNUSED(_gammaI_U2U2)
  READ_v_UNUSED(_gammaI_U0U0)


    unsigned nn = patch->nn;
    unsigned ijk;

    if (adm[p]->surface_integration_flg)
    {
      ADD_FIELD(ADM_mass_integrand_S)
      {
      const double *n_U0 = adm[p]->n_U0;
      const double *n_U1 = adm[p]->n_U1;
      const double *n_U2 = adm[p]->n_U2;
      REALLOC_v_WRITE_v(ADM_mass_integrand_S)
      for (ijk = 0; ijk < nn; ++ijk)
      {
      double dlnpsi_U0 = 
dpsi_D0[ijk]/psi[ijk];

      double dlnpsi_U2 = 
dpsi_D2[ijk]/psi[ijk];

      double dlnpsi_U1 = 
dpsi_D1[ijk]/psi[ijk];

      double M_s = 
n_U0[ijk]*(_gammaI_U0U1[ijk]*(_dgamma_D0D0D1[ijk] -
_dgamma_D0D1D0[ijk]) + _gammaI_U0U2[ijk]*(_dgamma_D0D0D2[ijk] -
_dgamma_D0D2D0[ijk]) + _gammaI_U1U1[ijk]*(_dgamma_D0D1D1[ijk] -
_dgamma_D1D1D0[ijk]) + _gammaI_U1U2[ijk]*(_dgamma_D0D1D2[ijk] -
_dgamma_D1D2D0[ijk]) + _gammaI_U1U2[ijk]*(_dgamma_D0D2D1[ijk] -
_dgamma_D1D2D0[ijk]) + _gammaI_U2U2[ijk]*(_dgamma_D0D2D2[ijk] -
_dgamma_D2D2D0[ijk]) - 8*dlnpsi_U0) - n_U1[ijk]*(_gammaI_U0U0[ijk]*
(_dgamma_D0D0D1[ijk] - _dgamma_D0D1D0[ijk]) + _gammaI_U0U1[ijk]*
(_dgamma_D0D1D1[ijk] - _dgamma_D1D1D0[ijk]) - _gammaI_U0U2[ijk]*
(_dgamma_D0D1D2[ijk] - _dgamma_D0D2D1[ijk]) + _gammaI_U0U2[ijk]*
(_dgamma_D0D2D1[ijk] - _dgamma_D1D2D0[ijk]) - _gammaI_U1U2[ijk]*
(_dgamma_D1D1D2[ijk] - _dgamma_D1D2D1[ijk]) - _gammaI_U2U2[ijk]*
(_dgamma_D1D2D2[ijk] - _dgamma_D2D2D1[ijk]) + 8*dlnpsi_U1) - n_U2[ijk]*
(_gammaI_U0U0[ijk]*(_dgamma_D0D0D2[ijk] - _dgamma_D0D2D0[ijk]) +
_gammaI_U0U1[ijk]*(_dgamma_D0D1D2[ijk] - _dgamma_D0D2D1[ijk]) +
_gammaI_U0U1[ijk]*(_dgamma_D0D1D2[ijk] - _dgamma_D1D2D0[ijk]) +
_gammaI_U0U2[ijk]*(_dgamma_D0D2D2[ijk] - _dgamma_D2D2D0[ijk]) +
_gammaI_U1U1[ijk]*(_dgamma_D1D1D2[ijk] - _dgamma_D1D2D1[ijk]) +
_gammaI_U1U2[ijk]*(_dgamma_D1D2D2[ijk] - _dgamma_D2D2D1[ijk]) + 8*
dlnpsi_U2);

      ADM_mass_integrand_S[ijk] = M_s;
      }
      }
      DECLARE_FIELD(ADM_mass_integrand_S)
      Integration_T *I = init_integration();
      I->type = "Integral{f(x)dS},Spectral";
      I->Spectral->f = ADM_mass_integrand_S;
      I->g00 = adm[p]->g00;
      I->g01 = adm[p]->g01;
      I->g02 = adm[p]->g02;
      I->g11 = adm[p]->g11;
      I->g12 = adm[p]->g12;
      I->g22 = adm[p]->g22;
      I->Spectral->X_surface = adm[p]->X_surface;
      I->Spectral->Y_surface = adm[p]->Y_surface;
      I->Spectral->Z_surface = adm[p]->Z_surface;
      I->Spectral->I         = adm[p]->I;
      I->Spectral->J         = adm[p]->J;
      I->Spectral->K         = adm[p]->K;
      plan_integration(I);
      adm_mass += execute_integration(I);
      free_integration(I);
      REMOVE_FIELD(ADM_mass_integrand_S)
    }
    else
    {
      Error0("Wrong flag!\n");
    }
    bbn_rm_1st_derivatives_conformal_metric(patch);

  }
  adm_mass /= (16*M_PI);
  return adm_mass;
}
