/*
  These C codes generated by Cpi version 1.0
  Copyright (C) 2019 Alireza Rashti.
*/


#include "bbn_headers.h"

#define add_field_and_alloc_field(name) ADD_FIELD(name) REALLOC_v_WRITE_v(name)

void bbn_bam_set_bam_fields(Grid_T *const grid);
void bbn_bam_set_bam_fields(Grid_T *const grid)
{
  unsigned p;
  const unsigned np = grid->np;

  OpenMP_Patch_Pragma(omp parallel for)
  for (p = 0; p < np; ++p)
  {
  Patch_T *patch = grid->patch[p];
  unsigned nn    = patch->nn;
  unsigned ijk;

  /* declaring: */
  add_field_and_alloc_field(bam_alpha)
  add_field_and_alloc_field(bam_grhd_rho)
  add_field_and_alloc_field(bam_grhd_p)
  add_field_and_alloc_field(bam_grhd_epsl)
  add_field_and_alloc_field(bam_Beta_U0)
  add_field_and_alloc_field(bam_Beta_U1)
  add_field_and_alloc_field(bam_Beta_U2)
  add_field_and_alloc_field(bam_adm_g_D0D0)
  add_field_and_alloc_field(bam_adm_g_D0D1)
  add_field_and_alloc_field(bam_adm_g_D0D2)
  add_field_and_alloc_field(bam_adm_g_D2D2)
  add_field_and_alloc_field(bam_adm_g_D1D1)
  add_field_and_alloc_field(bam_adm_g_D1D2)
  add_field_and_alloc_field(bam_adm_K_D1D1)
  add_field_and_alloc_field(bam_adm_K_D2D2)
  add_field_and_alloc_field(bam_adm_K_D0D0)
  add_field_and_alloc_field(bam_adm_K_D0D1)
  add_field_and_alloc_field(bam_adm_K_D0D2)
  add_field_and_alloc_field(bam_adm_K_D1D2)
  add_field_and_alloc_field(bam_grhd_v_U0)
  add_field_and_alloc_field(bam_grhd_v_U1)
  add_field_and_alloc_field(bam_grhd_v_U2)
  READ_v(_A_UiUj_U2U2)
  READ_v(_A_UiUj_U1U2)
  READ_v(_A_UiUj_U1U1)
  READ_v(_A_UiUj_U0U2)
  READ_v(_A_UiUj_U0U1)
  READ_v(_A_UiUj_U0U0)
  READ_v(Beta_U1)
  READ_v(Beta_U0)
  READ_v(Beta_U2)
  READ_v(B1_U0)
  READ_v(B1_U1)
  READ_v(B1_U2)
  READ_v(psi)
  READ_v(eta)
  READ_v(K)
  READ_v(enthalpy)
  READ_v(W_U1)
  READ_v(W_U0)
  READ_v(W_U2)
  READ_v(dphi_D2)
  READ_v(dphi_D1)
  READ_v(dphi_D0)
  READ_v(u0)
  READ_v(_gamma_D2D2)
  READ_v(_gamma_D0D2)
  READ_v(_gamma_D0D0)
  READ_v(_gamma_D0D1)
  READ_v(_gamma_D1D2)
  READ_v(_gamma_D1D1)
  READ_v(_gammaI_U0U2)
  READ_v(_gammaI_U0U0)
  READ_v(_gammaI_U0U1)
  READ_v(_gammaI_U1U2)
  READ_v(_gammaI_U1U1)
  READ_v(_gammaI_U2U2)


  if (!IsItInsideBHPatch(patch))
  for(ijk = 0; ijk < nn; ++ijk)
  {
  double psi4 = 
pow(psi[ijk], 4);

  double psim4 = 
pow(psi[ijk], -4);

  double psim10 = 
pow(psim4, 2)/pow(psi[ijk], 2);

   bam_alpha[ijk] = eta[ijk]/psi[ijk];
   bam_Beta_U0[ijk] = Beta_U0[ijk];
   bam_Beta_U1[ijk] = Beta_U1[ijk];
   bam_Beta_U2[ijk] = Beta_U2[ijk];
   double adm_g_D0D2 = 
_gamma_D0D2[ijk]*psi4;

   double adm_g_D0D1 = 
_gamma_D0D1[ijk]*psi4;

   double adm_g_D0D0 = 
_gamma_D0D0[ijk]*psi4;

   double adm_g_D1D2 = 
_gamma_D1D2[ijk]*psi4;

   double adm_g_D1D1 = 
_gamma_D1D1[ijk]*psi4;

   double adm_g_D2D2 = 
_gamma_D2D2[ijk]*psi4;


   /* populating: */
   bam_adm_g_D0D0[ijk] = adm_g_D0D0;
   bam_adm_g_D0D1[ijk] = adm_g_D0D1;
   bam_adm_g_D0D2[ijk] = adm_g_D0D2;
   bam_adm_g_D2D2[ijk] = adm_g_D2D2;
   bam_adm_g_D1D1[ijk] = adm_g_D1D1;
   bam_adm_g_D1D2[ijk] = adm_g_D1D2;
   double adm_Kuu_U1U2 = 
(1.0/3.0)*K[ijk]*_gammaI_U1U2[ijk]*psim4 + _A_UiUj_U1U2[ijk]*
psim10;

   double adm_Kuu_U1U1 = 
(1.0/3.0)*K[ijk]*_gammaI_U1U1[ijk]*psim4 + _A_UiUj_U1U1[ijk]*
psim10;

   double adm_Kuu_U0U2 = 
(1.0/3.0)*K[ijk]*_gammaI_U0U2[ijk]*psim4 + _A_UiUj_U0U2[ijk]*
psim10;

   double adm_Kuu_U0U1 = 
(1.0/3.0)*K[ijk]*_gammaI_U0U1[ijk]*psim4 + _A_UiUj_U0U1[ijk]*
psim10;

   double adm_Kuu_U0U0 = 
(1.0/3.0)*K[ijk]*_gammaI_U0U0[ijk]*psim4 + _A_UiUj_U0U0[ijk]*
psim10;

   double adm_Kuu_U2U2 = 
(1.0/3.0)*K[ijk]*_gammaI_U2U2[ijk]*psim4 + _A_UiUj_U2U2[ijk]*
psim10;

   double adm_Kdd_D0D1 = 
adm_Kuu_U0U0*adm_g_D0D0*adm_g_D0D1 + adm_Kuu_U0U1*adm_g_D0D0*
adm_g_D1D1 + adm_Kuu_U0U1*pow(adm_g_D0D1, 2) + adm_Kuu_U0U2*adm_g_D0D0*
adm_g_D1D2 + adm_Kuu_U0U2*adm_g_D0D1*adm_g_D0D2 + adm_Kuu_U1U1*
adm_g_D0D1*adm_g_D1D1 + adm_Kuu_U1U2*adm_g_D0D1*adm_g_D1D2 + 
adm_Kuu_U1U2*adm_g_D0D2*adm_g_D1D1 + adm_Kuu_U2U2*adm_g_D0D2*
adm_g_D1D2;

   double adm_Kdd_D0D0 = 
adm_Kuu_U0U0*pow(adm_g_D0D0, 2) + 2.0*adm_Kuu_U0U1*adm_g_D0D0*
adm_g_D0D1 + 2.0*adm_Kuu_U0U2*adm_g_D0D0*adm_g_D0D2 + adm_Kuu_U1U1*
pow(adm_g_D0D1, 2) + 2.0*adm_Kuu_U1U2*adm_g_D0D1*adm_g_D0D2 + 
adm_Kuu_U2U2*pow(adm_g_D0D2, 2);

   double adm_Kdd_D0D2 = 
adm_Kuu_U0U0*adm_g_D0D0*adm_g_D0D2 + adm_Kuu_U0U1*adm_g_D0D0*
adm_g_D1D2 + adm_Kuu_U0U1*adm_g_D0D1*adm_g_D0D2 + adm_Kuu_U0U2*
adm_g_D0D0*adm_g_D2D2 + adm_Kuu_U0U2*pow(adm_g_D0D2, 2) + adm_Kuu_U1U1*
adm_g_D0D1*adm_g_D1D2 + adm_Kuu_U1U2*adm_g_D0D1*adm_g_D2D2 + 
adm_Kuu_U1U2*adm_g_D0D2*adm_g_D1D2 + adm_Kuu_U2U2*adm_g_D0D2*
adm_g_D2D2;

   double adm_Kdd_D1D1 = 
adm_Kuu_U0U0*pow(adm_g_D0D1, 2) + 2.0*adm_Kuu_U0U1*adm_g_D0D1*
adm_g_D1D1 + 2.0*adm_Kuu_U0U2*adm_g_D0D1*adm_g_D1D2 + adm_Kuu_U1U1*
pow(adm_g_D1D1, 2) + 2.0*adm_Kuu_U1U2*adm_g_D1D1*adm_g_D1D2 + 
adm_Kuu_U2U2*pow(adm_g_D1D2, 2);

   double adm_Kdd_D1D2 = 
adm_Kuu_U0U0*adm_g_D0D1*adm_g_D0D2 + adm_Kuu_U0U1*adm_g_D0D1*
adm_g_D1D2 + adm_Kuu_U0U1*adm_g_D0D2*adm_g_D1D1 + adm_Kuu_U0U2*
adm_g_D0D1*adm_g_D2D2 + adm_Kuu_U0U2*adm_g_D0D2*adm_g_D1D2 + 
adm_Kuu_U1U1*adm_g_D1D1*adm_g_D1D2 + adm_Kuu_U1U2*adm_g_D1D1*
adm_g_D2D2 + adm_Kuu_U1U2*pow(adm_g_D1D2, 2) + adm_Kuu_U2U2*adm_g_D1D2*
adm_g_D2D2;

   double adm_Kdd_D2D2 = 
adm_Kuu_U0U0*pow(adm_g_D0D2, 2) + 2.0*adm_Kuu_U0U1*adm_g_D0D2*
adm_g_D1D2 + 2.0*adm_Kuu_U0U2*adm_g_D0D2*adm_g_D2D2 + adm_Kuu_U1U1*
pow(adm_g_D1D2, 2) + 2.0*adm_Kuu_U1U2*adm_g_D1D2*adm_g_D2D2 + 
adm_Kuu_U2U2*pow(adm_g_D2D2, 2);


   /* populating: */
   bam_adm_K_D1D1[ijk] = adm_Kdd_D1D1;
   bam_adm_K_D2D2[ijk] = adm_Kdd_D2D2;
   bam_adm_K_D0D0[ijk] = adm_Kdd_D0D0;
   bam_adm_K_D0D1[ijk] = adm_Kdd_D0D1;
   bam_adm_K_D0D2[ijk] = adm_Kdd_D0D2;
   bam_adm_K_D1D2[ijk] = adm_Kdd_D1D2;
  }
  if (IsItNSPatch(patch))
  {
  EoS_T *eos = initialize_EoS();
  for(ijk = 0; ijk < nn; ++ijk)
  {
  double psim4_ = 
pow(psi[ijk], -4);

  double grhd_v_U1 = 
(W_U1[ijk] + psim4_*(_gammaI_U0U1[ijk]*dphi_D0[ijk] + 
_gammaI_U1U1[ijk]*dphi_D1[ijk] + _gammaI_U1U2[ijk]*dphi_D2[ijk]))/
(bam_alpha[ijk]*enthalpy[ijk]*u0[ijk]);

  double grhd_v_U0 = 
(W_U0[ijk] + psim4_*(_gammaI_U0U0[ijk]*dphi_D0[ijk] + 
_gammaI_U0U1[ijk]*dphi_D1[ijk] + _gammaI_U0U2[ijk]*dphi_D2[ijk]))/
(bam_alpha[ijk]*enthalpy[ijk]*u0[ijk]);

  double grhd_v_U2 = 
(W_U2[ijk] + psim4_*(_gammaI_U0U2[ijk]*dphi_D0[ijk] + 
_gammaI_U1U2[ijk]*dphi_D1[ijk] + _gammaI_U2U2[ijk]*dphi_D2[ijk]))/
(bam_alpha[ijk]*enthalpy[ijk]*u0[ijk]);


  /* populating: */
  bam_grhd_v_U0[ijk] = grhd_v_U0;
  bam_grhd_v_U1[ijk] = grhd_v_U1;
  bam_grhd_v_U2[ijk] = grhd_v_U2;
  
  eos->h = enthalpy[ijk];
  if(!isfinite(eos->h) || LSSEQL(eos->h,1))
  {
    bam_grhd_rho[ijk]  = 0;
    bam_grhd_p[ijk]    = 0;
    bam_grhd_epsl[ijk] = 0;
  }
  else
  {
   bam_grhd_rho[ijk]  = eos->rest_mass_density(eos);
   bam_grhd_p[ijk]    = eos->pressure(eos);
   bam_grhd_epsl[ijk] = eos->energy_density(eos)/bam_grhd_rho[ijk]-1.0;
  }
  }
  free_EoS(eos);
  }
  for(ijk = 0; ijk < nn; ++ijk)
  {
  double temp_bh2_D0D0 = 
1.0;

  double temp_bh2_D2D2 = 
1.0;

  double temp_bh2_D1D2 = 
0;

  double temp_bh2_D0D2 = 
0;

  double temp_bh2_D0D1 = 
0;

  double temp_bh2_D1D1 = 
1.0;

  double temp_bh1_U2 = 
B1_U2[ijk];

  double temp_bh1_U1 = 
B1_U1[ijk];

  double temp_bh1_U0 = 
B1_U0[ijk];

  bam_alpha[ijk] = eta[ijk]/psi[ijk];

  /* populating: */
  bam_Beta_U0[ijk] = temp_bh1_U0;
  bam_Beta_U1[ijk] = temp_bh1_U1;
  bam_Beta_U2[ijk] = temp_bh1_U2;

  /* populating: */
  bam_adm_g_D0D0[ijk] = temp_bh2_D0D0;
  bam_adm_g_D0D1[ijk] = temp_bh2_D0D1;
  bam_adm_g_D0D2[ijk] = temp_bh2_D0D2;
  bam_adm_g_D2D2[ijk] = temp_bh2_D2D2;
  bam_adm_g_D1D1[ijk] = temp_bh2_D1D1;
  bam_adm_g_D1D2[ijk] = temp_bh2_D1D2;

  /* populating: */
  bam_adm_K_D1D1[ijk] = temp_bh2_D1D1;
  bam_adm_K_D2D2[ijk] = temp_bh2_D2D2;
  bam_adm_K_D0D0[ijk] = temp_bh2_D0D0;
  bam_adm_K_D0D1[ijk] = temp_bh2_D0D1;
  bam_adm_K_D0D2[ijk] = temp_bh2_D0D2;
  bam_adm_K_D1D2[ijk] = temp_bh2_D1D2;
  }
  }
}
