/*
  These C codes generated by Cpi version 2.0
  Copyright (C) 2019-2020 Alireza Rashti.
*/


#include "dg_header.h"
#include "maths_linear_algebra_lib.h"



#define STR_LEN (99)



#define Write_v_indexed(name,stem)  \
  double *name = 0; \
  if (stem) \
  { \
    sprintf(fname,"%s%s",stem,strrchr(#name,'_')); \
    free_coeffs(patch->fields[Ind(fname)]); \
    name = patch->fields[Ind(fname)]->v; \
    if(!name) \
    { \
      name = patch->fields[Ind(fname)]->v = alloc_double(patch->nn); \
    } \
  }


#define Write_v_scalar(name,stem)  \
  double *name = 0; \
  if (stem) \
  { \
    sprintf(fname,"%s",stem); \
    free_coeffs(patch->fields[Ind(fname)]); \
    name = patch->fields[Ind(fname)]->v; \
    if(!name) \
    { \
      name = patch->fields[Ind(fname)]->v = alloc_double(patch->nn); \
    } \
  }


void scale_to_BSSN_metric_3d(Patch_T *const patch,
                              const char *const given_g,
                              const char *const BSSN_g,
                              const char *const iBSSN_g,
                              const char *const Psi);


void scale_to_BSSN_metric_3d(Patch_T *const patch,
                              const char *const given_g,
                              const char *const BSSN_g,
                              const char *const iBSSN_g,
                              const char *const Psi)
{
 char fname[STR_LEN] = {'\0'};


  /* declaring: */
  READ_v_STEM(adm_g_D0D2,given_g)
  READ_v_STEM(adm_g_D0D1,given_g)
  READ_v_STEM(adm_g_D0D0,given_g)
  READ_v_STEM(adm_g_D1D2,given_g)
  READ_v_STEM(adm_g_D1D1,given_g)
  READ_v_STEM(adm_g_D2D2,given_g)
  Write_v_indexed(bssn_g_D0D0,BSSN_g)
  Write_v_indexed(bssn_g_D0D1,BSSN_g)
  Write_v_indexed(bssn_g_D0D2,BSSN_g)
  Write_v_indexed(bssn_g_D2D2,BSSN_g)
  Write_v_indexed(bssn_g_D1D1,BSSN_g)
  Write_v_indexed(bssn_g_D1D2,BSSN_g)
  Write_v_indexed(bssn_gI_U0U0,iBSSN_g)
  Write_v_indexed(bssn_gI_U0U1,iBSSN_g)
  Write_v_indexed(bssn_gI_U0U2,iBSSN_g)
  Write_v_indexed(bssn_gI_U1U1,iBSSN_g)
  Write_v_indexed(bssn_gI_U1U2,iBSSN_g)
  Write_v_indexed(bssn_gI_U2U2,iBSSN_g)
  Write_v_scalar(bssn_psi,Psi)


 FOR_ALL_ijk
 {
 double detgb=Matrix_Determinant_3x3_Symmetric_Field(adm_g,D,ijk);

  double psi12 = 
detgb;

  double psim4 = 
pow(psi12, -0.33333333333333331);

  double psi = 
pow(psi12, 0.083333333333333329);

  double Bssn_g_D0D0 = 
adm_g_D0D0[ijk]*psim4;

  double Bssn_g_D0D1 = 
adm_g_D0D1[ijk]*psim4;

  double Bssn_g_D0D2 = 
adm_g_D0D2[ijk]*psim4;

  double Bssn_g_D2D2 = 
adm_g_D2D2[ijk]*psim4;

  double Bssn_g_D1D1 = 
adm_g_D1D1[ijk]*psim4;

  double Bssn_g_D1D2 = 
adm_g_D1D2[ijk]*psim4;

 if (BSSN_g)
 {

 /* populating: */
 bssn_g_D0D0[ijk] = Bssn_g_D0D0;
 bssn_g_D0D1[ijk] = Bssn_g_D0D1;
 bssn_g_D0D2[ijk] = Bssn_g_D0D2;
 bssn_g_D2D2[ijk] = Bssn_g_D2D2;
 bssn_g_D1D1[ijk] = Bssn_g_D1D1;
 bssn_g_D1D2[ijk] = Bssn_g_D1D2;
 }

 if (iBSSN_g)
 {
 double Bssn_gI_U0U0 = 
1.0;

 double Bssn_gI_U0U1 = 
0;

 double Bssn_gI_U0U2 = 
0;

 double Bssn_gI_U1U1 = 
1.0;

 double Bssn_gI_U1U2 = 
0;

 double Bssn_gI_U2U2 = 
1.0;

 Matrix_Inverse_3x3_Symmetric_Var(Bssn_g,D,Bssn_gI,U);

 /* populating: */
 bssn_gI_U0U0[ijk] = Bssn_gI_U0U0;
 bssn_gI_U0U1[ijk] = Bssn_gI_U0U1;
 bssn_gI_U0U2[ijk] = Bssn_gI_U0U2;
 bssn_gI_U1U1[ijk] = Bssn_gI_U1U1;
 bssn_gI_U1U2[ijk] = Bssn_gI_U1U2;
 bssn_gI_U2U2[ijk] = Bssn_gI_U2U2;
 }

 if (Psi)
 {
 bssn_psi[ijk] = psi;
 }
 }
}
